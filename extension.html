<!DOCTYPE html>
<html>
<head>
  <title>Data Analysis</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon"></script>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      color: black;
    }
    #app {
      text-align: center;
      width: 100%;
      max-width: 800px;
    }
    #search-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }
    #prompt {
      width: 100%;
      padding: 10px 40px 10px 10px;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 20px;
      outline: none;
      box-sizing: border-box;
    }
    #search-button {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 0;
    }
    #search-icon {
      width: 20px;
      height: 20px;
    }
    #chartContainer {
      display: none;
      margin-top: 20px;
      width: 100%;
      height: 600px;
    }
    canvas {
      width: 100% !important;
      height: auto !important;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="search-container">
      <input type="text" id="prompt" placeholder="Search...">
      <button id="search-button" onclick="sendPrompt()">
        <img src="data:image/png;base64,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" id="search-icon" alt="Search">
      </button>
    </div>
    <div id="chartContainer">
      <canvas id="myChart"></canvas>
    </div>
  </div>

  <script>
    async function sendPrompt() {
      const prompt = document.getElementById('prompt').value;
      console.log('Prompt entered:', prompt);

      let chartType = 'line';
      if (prompt.toLowerCase().includes('bar')) {
        chartType = 'bar';
      }

      try {
        const response = await fetch('http://localhost:5000/fetch_data', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt })
        });

        console.log('Response status:', response.status);

        if (response.ok) {
          const result = await response.json();
          console.log('Data received:', result);
          const tableName = result.tableName || 'Chart';
          determineChartConfigAndDisplay(result.data, chartType, tableName);
        } else {
          console.error('Failed to fetch data:', response.statusText);
        }
      } catch (error) {
        console.error('Error occurred during fetch:', error);
      }
    }

    function determineChartConfigAndDisplay(data, chartType, tableName) {
      if (!data || data.length === 0) {
        console.error('No data received to display');
        return;
      }

      console.log('Data for chart configuration:', data);

      let labels = [];
      let values = [];
      let xAxisLabel = '';
      let yAxisLabel = '';

      const firstItem = data[0];
      const dateProperties = ['month', 'year', 'quarter'];
      const numericProperties = Object.keys(firstItem).filter(key => typeof firstItem[key] === 'number');

      const dateProperty = dateProperties.find(prop => prop in firstItem);
      if (dateProperty) {
        if (dateProperty === 'month') {
          labels = data.map(item => {
            const date = luxon.DateTime.fromHTTP(item[dateProperty]);
            console.log(`Parsing date '${item[dateProperty]}' as month:`, date);
            return date.isValid ? date.toFormat('yyyy-MM') : 'Invalid DateTime';
          });
        } else if (dateProperty === 'year') {
          labels = data.map(item => {
            const date = luxon.DateTime.fromHTTP(item[dateProperty]);
            console.log(`Parsing date '${item[dateProperty]}' as year:`, date);
            return date.isValid ? date.toFormat('yyyy') : 'Invalid DateTime';
          });
        } else {
          labels = data.map(item => item[dateProperty]);
        }
        xAxisLabel = dateProperty.charAt(0).toUpperCase() + dateProperty.slice(1).replace(/_/g, ' ');
      } else {
        console.error('No date property found');
        return;
      }

      if (numericProperties.length > 0) {
        values = data.map(item => item[numericProperties[0]]);
        yAxisLabel = numericProperties[0].charAt(0).toUpperCase() + numericProperties[0].slice(1).replace(/_/g, ' ');
      } else {
        console.error('No numeric property found');
        return;
      }

      const chartTitle = tableName.charAt(0).toUpperCase() + tableName.slice(1).replace(/_/g, ' ');

      console.log('Labels:', labels);
      console.log('Values:', values);
      console.log('X Axis Label:', xAxisLabel);
      console.log('Y Axis Label:', yAxisLabel);
      console.log('Chart type:', chartType);
      console.log('Chart title:', chartTitle);

      displayChart(labels, values, xAxisLabel, yAxisLabel, chartType, chartTitle);
    }

    function displayChart(labels, values, xAxisLabel, yAxisLabel, chartType, chartTitle) {
      const ctx = document.getElementById('myChart').getContext('2d');

      document.getElementById('chartContainer').style.display = 'block';

      if (window.myChart && typeof window.myChart.destroy === 'function') {
        window.myChart.destroy();
      }

      window.myChart = new Chart(ctx, {
        type: chartType,
        data: {
          labels: labels,
          datasets: [{
            label: yAxisLabel,
            data: values,
            backgroundColor: chartType === 'bar' ? 'rgba(75, 192, 192, 0.2)' : 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1,
            fill: chartType !== 'bar'
          }]
        },
        options: {
          plugins: {
            title: {
              display: true,
              text: chartTitle,
              color: 'black'
            }
          },
          scales: {
            x: {
              type: chartType === 'bar' ? 'category' : 'time',
              title: {
                display: true,
                text: xAxisLabel,
                color: 'black'
              },
              time: {
                unit: chartType === 'bar' ? undefined : 'year',
                tooltipFormat: chartType === 'bar' ? undefined : 'yyyy'
              },
              adapters: {
                date: {
                  lib: 'luxon'
                }
              },
              ticks: {
                color: 'black'
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              }
            },
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: yAxisLabel,
                color: 'black'
              },
              ticks: {
                color: 'black'
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              }
            }
          }
        }
      });

      console.log('Chart rendered successfully');
    }
  </script>
</body>
</html>
